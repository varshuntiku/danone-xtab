"""empty message

Revision ID: 3d0ea78696d8
Revises: 6c5b8565226d
Create Date: 2023-09-14 15:24:49.911849

"""
from alembic import op
import sqlalchemy as sa
from sqlalchemy.dialects import postgresql

# revision identifiers, used by Alembic.
revision = '3d0ea78696d8'
down_revision = 'ceb64e014bb8'
branch_labels = None
depends_on = None


def upgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    op.execute('CREATE EXTENSION IF NOT EXISTS "uuid-ossp"')
    op.create_table('minerva_consumer',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), server_default=sa.text('now()'), nullable=True),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('deleted_at', sa.DateTime(timezone=True), nullable=True),
    sa.Column('name', sa.String(length=100), nullable=False),
    sa.Column('desc', sa.Text(), nullable=True),
    sa.Column('access_key', postgresql.UUID(), server_default=sa.text('uuid_generate_v4()'), nullable=False),
    sa.Column('allowed_origins', sa.JSON(), nullable=True),
    sa.Column('features', sa.JSON(), nullable=True),
    sa.Column('auth_agents', sa.JSON(), nullable=True),
    sa.Column('created_by', sa.Integer(), nullable=True),
    sa.Column('updated_by', sa.Integer(), nullable=True),
    sa.Column('deleted_by', sa.Integer(), nullable=True),
    sa.ForeignKeyConstraint(['created_by'], ['user.id'], ),
    sa.ForeignKeyConstraint(['deleted_by'], ['user.id'], ),
    sa.ForeignKeyConstraint(['updated_by'], ['user.id'], ),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('access_key')
    )
    op.create_table('minerva_app_consumer_mapping',
    sa.Column('minerva_app_id', sa.Integer(), nullable=True),
    sa.Column('consumer_id', sa.Integer(), nullable=True),
    sa.ForeignKeyConstraint(['consumer_id'], ['minerva_consumer.id'], ),
    sa.ForeignKeyConstraint(['minerva_app_id'], ['minerva_apps.id'], )
    )

    op.execute(
        "ALTER TABLE public.minerva_job_status ALTER COLUMN run_id TYPE VARCHAR(100)"
        )
    # ### end Alembic commands ###


def downgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_table('minerva_app_consumer_mapping')
    op.drop_table('minerva_consumer')
    # ### end Alembic commands ###
