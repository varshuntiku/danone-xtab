"""Update progress_bar table

Revision ID: de761384327f
Revises: f9ac27504107
Create Date: 2024-08-26 15:51:45.155783

"""
from typing import Sequence, Union

from alembic import op
import sqlalchemy as sa


# revision identifiers, used by Alembic.
revision: str = "de761384327f"
down_revision: Union[str, None] = "f9ac27504107"
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.add_column("progress_bar", sa.Column("screen_id", sa.Integer(), nullable=True))
    op.add_column("progress_bar", sa.Column("stage_descriptions", sa.JSON(), nullable=True))
    op.add_column("progress_bar", sa.Column("title", sa.String(length=1000), nullable=True))
    op.drop_index("ix_progress_bar_app_id_user_id", table_name="progress_bar")
    op.create_index(
        "ix_progress_bar_app_id_screen_id_user_id", "progress_bar", ["app_id", "screen_id", "user_id"], unique=True
    )
    op.create_foreign_key(None, "progress_bar", "app_screen", ["screen_id"], ["id"])
    # ### end Alembic commands ###


def downgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_constraint(None, "progress_bar", type_="foreignkey")
    op.drop_index("ix_progress_bar_app_id_screen_id_user_id", table_name="progress_bar")
    op.create_index("ix_progress_bar_app_id_user_id", "progress_bar", ["app_id", "user_id"], unique=True)
    op.drop_column("progress_bar", "title")
    op.drop_column("progress_bar", "stage_descriptions")
    op.drop_column("progress_bar", "screen_id")
    # ### end Alembic commands ###
